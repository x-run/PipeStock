# PHASES - 段階実行手順

## 概要

MVP を6つの Phase に分割して段階的に実装する。
各 Phase は独立してデプロイ・検証可能な単位とする。

---

## Phase 1: プロジェクトセットアップ

**目的**: 開発環境と基盤を構築する

### タスク

- [ ] 1-1. プロジェクト初期化 (パッケージマネージャ、ディレクトリ構成)
- [ ] 1-2. 技術スタック選定と依存関係のインストール
- [ ] 1-3. データベースセットアップ (スキーマ定義、マイグレーション)
- [ ] 1-4. Product テーブル作成
- [ ] 1-5. Transaction テーブル作成
- [ ] 1-6. リンター・フォーマッター設定
- [ ] 1-7. テストフレームワーク設定

### 完了条件

- マイグレーションが正常に実行できる
- テストランナーが動作する
- Product / Transaction テーブルが作成されている

---

## Phase 2: 商品マスタ API

**目的**: 商品の CRUD を実装する

### タスク

- [ ] 2-1. Product モデル定義
- [ ] 2-2. POST /api/v1/products (新規作成)
- [ ] 2-3. GET /api/v1/products (一覧取得、ページネーション、検索)
- [ ] 2-4. GET /api/v1/products/:id (詳細取得)
- [ ] 2-5. PATCH /api/v1/products/:id (更新、楽観ロック)
- [ ] 2-6. DELETE /api/v1/products/:id (論理削除)
- [ ] 2-7. バリデーション実装 (コードユニーク制約含む)
- [ ] 2-8. Phase 2 のテスト作成・実行

### 完了条件

- 全 Product エンドポイントが API 仕様通りに動作する
- 楽観ロックが正しく競合を検出する
- 論理削除が動作する
- テストが全件パスする

---

## Phase 3: トランザクション API とドメインロジック

**目的**: 在庫変動の中核ロジックを実装する

### タスク

- [ ] 3-1. Transaction モデル定義
- [ ] 3-2. 在庫計算ロジック (SUM 集計による On-hand / Reserved / Available 算出)
- [ ] 3-3. POST /api/v1/products/:product_id/transactions (Tx 作成)
- [ ] 3-4. 不変条件 INV-1〜INV-8 のバリデーション実装
- [ ] 3-5. Available 不足時のエラーハンドリング (INV-3: OUT/ON_HAND および IN/RESERVED)
- [ ] 3-6. ADJUST は ON_HAND のみバリデーション (INV-6)
- [ ] 3-7. 非アクティブ商品への Tx 拒否 (INV-8)
- [ ] 3-8. GET /api/v1/products/:product_id/transactions (履歴取得)
- [ ] 3-9. POST /api/v1/products/:product_id/transactions/batch (バッチ Tx 作成)
- [ ] 3-10. Phase 3 のテスト作成・実行

### 完了条件

- 全 Tx エンドポイント (単体・バッチ) が API 仕様通りに動作する
- 全不変条件が正しく検証される
- Available 不足時に 409 エラーが返る (出庫・引当の両方)
- バッチ Tx が原子的に処理される (all-or-nothing)
- Tx は作成のみ可能 (更新・削除不可)
- テストが全件パスする

---

## Phase 4: 在庫サマリ API

**目的**: ダッシュボード向けの在庫集計を提供する

### タスク

- [ ] 4-1. GET /api/v1/stock (全商品の在庫サマリ一覧)
- [ ] 4-2. 在庫金額・重量の算出 (On-hand × unit_price / unit_weight)
- [ ] 4-3. 発注点以下フィルタ (below_reorder パラメータ)
- [ ] 4-4. GET /api/v1/products/:id のレスポンスに stock 情報を追加
- [ ] 4-5. Phase 4 のテスト作成・実行

### 完了条件

- 在庫サマリが正しく算出される
- 発注点フィルタが動作する
- 商品詳細に stock 情報が含まれる
- テストが全件パスする

---

## Phase 5: フロントエンド実装

**目的**: UI 仕様に基づいた画面を構築する

### タスク

- [ ] 5-1. フロントエンド環境セットアップ
- [ ] 5-2. 共通レイアウト・ナビゲーション
- [ ] 5-3. ダッシュボード画面 (在庫サマリ一覧)
  - サマリカード (総商品数・在庫総額・要発注数)
  - Available を太字・メインカラーで表示
  - Reserved を薄い色で表示
  - 発注点以下の行を警告色で強調
- [ ] 5-4. 商品一覧画面
- [ ] 5-5. 商品登録/編集画面 (フォームバリデーション含む)
- [ ] 5-6. 商品詳細画面 (在庫サマリ + Tx 履歴)
- [ ] 5-7. Tx 登録画面 (操作選択 UI + Available チェック警告)
- [ ] 5-8. 数値フォーマット (通貨・重量)
- [ ] 5-9. Phase 5 のテスト作成・実行

### 完了条件

- 全画面が UI 仕様通りに表示される
- Reserved 系の値が薄い色で表示されている
- Available が主役として目立つ
- 発注点以下の商品が視覚的に警告される
- 画面遷移が正しく動作する

---

## Phase 6: 結合テスト・仕上げ

**目的**: 全体を通した動作確認と品質向上

### タスク

- [ ] 6-1. E2E シナリオテスト (入庫 → 引当 → 出荷 の一連の流れ)
- [ ] 6-2. エラーケースの結合テスト
- [ ] 6-3. エッジケース対応 (0 個在庫、大量データ)
- [ ] 6-4. UI の微調整・レスポンシブ対応
- [ ] 6-5. README.md 更新 (セットアップ手順)
- [ ] 6-6. 最終動作確認

### 完了条件

- 全シナリオテストがパスする
- 入庫 → 引当 → 出荷 → 棚卸補正 の一連の流れが動作する
- エラー時のユーザー体験が適切
- セットアップ手順で環境構築できる
