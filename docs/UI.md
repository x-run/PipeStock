# UI - 画面仕様

## 1. 画面一覧

| # | 画面名 | パス | 説明 |
|---|--------|------|------|
| 1 | ダッシュボード | `/` | 在庫サマリ一覧 (メイン画面) |
| 2 | 商品一覧 | `/products` | 商品マスタの管理 |
| 3 | 商品登録/編集 | `/products/new`, `/products/:id/edit` | 商品の作成・更新 |
| 4 | 商品詳細 | `/products/:id` | 商品情報 + Tx 履歴 |
| 5 | Tx 登録 | `/products/:id/transactions/new` | 入庫・出庫・引当・補正の記録 |

## 2. 表示ルール

### 2.1 色の使い分け

| 要素 | 表示スタイル | 理由 |
|------|-------------|------|
| Available | **太字・メインカラー** | 最も重要な数値。主役として目立たせる |
| On-hand | 通常テキスト | 参考値として表示 |
| Reserved | **薄い色 (opacity: 0.5 程度)** | 補助情報として控えめに表示 |
| Reserved のうち返品検品待ち | さらに薄い色 + ラベル「検品待ち」 | 返品由来の Reserved を区別 |
| 発注点以下の商品 | 行の背景色を警告色 (薄いオレンジ/赤) | 注意喚起 |

### 2.2 数値フォーマット

| 項目 | フォーマット | 例 |
|------|-------------|-----|
| 数量 | 整数 + 単位 | `80 本` |
| 単価 | 通貨 (3桁カンマ区切り) | `¥2,500` |
| 金額 | 通貨 (3桁カンマ区切り) | `¥250,000` |
| 重量 | 小数1位 + kg | `320.0 kg` |

---

## 3. 画面詳細

### 3.1 ダッシュボード (`/`)

数量中心のダッシュボード。全商品の在庫状況を俯瞰する。

**レイアウト:**

```
┌─────────────────────────────────────────────────────┐
│ PipeStock                          [商品管理]       │
├─────────────────────────────────────────────────────┤
│ サマリカード (数量 > 金額 > 重量 の優先順)              │
│ ┌──────────┐ ┌──────────┐ ┌──────────┐              │
│ │ 総商品数  │ │ 要発注    │ │ 在庫総額  │              │
│ │   25     │ │   3 ⚠   │ │¥1,250,000│              │
│ └──────────┘ └──────────┘ └──────────┘              │
├─────────────────────────────────────────────────────┤
│ [発注点以下のみ表示] チェックボックス   [検索...]     │
├──────┬──────┬──────────┬────────┬────────┬──────────┤
│ Code │ 名前  │ Available│On-hand │Reserved│ 金額     │
├──────┼──────┼──────────┼────────┼────────┼──────────┤
│PIPE  │ステン │ **80 本**│100 本  │ 20 本  │¥250,000  │
│-001  │レス…  │          │        │(薄い色)│          │
├──────┼──────┼──────────┼────────┼────────┼──────────┤
│PIPE  │銅パイ │ **5 本** │ 8 本   │  3 本  │¥ 40,000  │
│-002  │プ…   │  ⚠       │        │(薄い色)│  ⚠背景色 │
└──────┴──────┴──────────┴────────┴────────┴──────────┘
```

**要件:**
- Available 列を最も目立つように表示 (太字、メインカラー)
- Reserved 列は薄い色で表示
- 発注点以下の行は警告色の背景
- 各行クリックで商品詳細へ遷移
- サマリカードで全体状況を把握

#### 3.1.1 在庫棒グラフ (Top N)

サマリカードの下、テーブルの上に在庫数量の棒グラフを表示する。

```
┌─────────────────────────────────────────────────────┐
│ 在庫数量 Top 10          [数量 ▼] [もっと見る →]     │
├─────────────────────────────────────────────────────┤
│ PIPE-001 ████████████████████████████  200 本        │
│ PIPE-003 ██████████████████            120 本        │
│ PIPE-002 █████████████                  80 本        │
│ …                                                    │
│ その他   ████████                       50 本        │
└─────────────────────────────────────────────────────┘
```

**データソース:** `GET /api/v1/dashboard/stock/top`

**要件:**
- metric 切替: 「数量」(on_hand) / 「金額」(stock_value) のドロップダウン
- TopN の各バーの reserved 部分を薄い色で重ねて表示 (stacked bar)
  - reserved_pending_return はさらに薄い色で区別
  - reserved_pending_order も同様のルールで区別 (将来)
- 最後のバーに others_total を「その他」として表示
- 「もっと見る →」リンクで `/stock` (在庫一覧) に遷移
- limit のデフォルトは 10

---

### 3.2 商品一覧 (`/products`)

**レイアウト:**

```
┌─────────────────────────────────────────────────────┐
│ 商品管理                            [+ 新規登録]     │
├─────────────────────────────────────────────────────┤
│ [検索...]           [アクティブのみ ✓]               │
├──────┬──────┬──────┬──────┬────────┬────────────────┤
│ Code │ 名前  │ 単位 │ 単価  │ 発注点  │ ステータス    │
├──────┼──────┼──────┼──────┼────────┼────────────────┤
│PIPE  │ステン │  本  │¥2,500│  10    │ ● アクティブ   │
│-001  │レス…  │      │      │        │               │
└──────┴──────┴──────┴──────┴────────┴────────────────┘
```

---

### 3.3 商品登録/編集 (`/products/new`, `/products/:id/edit`)

**フォーム構成:**

```
┌─────────────────────────────────────────┐
│ 商品登録 / 商品編集                       │
├─────────────────────────────────────────┤
│ 商品コード *   [PIPE-001           ]    │
│ 商品名 *       [ステンレスパイプ 25A ]    │
│ 仕様           [SUS304 / 外径34mm   ]    │
│ 単位 *         [本                  ]    │
│ 単価 (円) *    [2500                ]    │
│ 単位重量 (kg)  [3.2                 ]    │
│ 発注点 *       [10                  ]    │
│                                         │
│              [キャンセル] [保存]          │
└─────────────────────────────────────────┘
```

**バリデーション:**
- `*` は必須項目
- 商品コードはユニーク (重複時はエラー表示)
- 単価・発注点は 0 以上
- 編集時は楽観ロック (version) を送信

---

### 3.4 商品詳細 (`/products/:id`)

**レイアウト:**

```
┌─────────────────────────────────────────────────────┐
│ ← 戻る     PIPE-001 ステンレスパイプ 25A   [編集]    │
├─────────────────────────────────────────────────────┤
│ 在庫サマリ                                           │
│ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐  │
│ │  Available   │ │   On-hand    │ │  Reserved    │  │
│ │  **80 本**   │ │   100 本     │ │   20 本      │  │
│ │  メインカラー │ │   通常       │ │  (薄い色)    │  │
│ └──────────────┘ └──────────────┘ └──────────────┘  │
│ 在庫金額: ¥250,000    在庫重量: 320.0 kg             │
├─────────────────────────────────────────────────────┤
│ 商品情報                                             ��
│ 仕様: SUS304 / 外径34mm / 肉厚1.5mm                 │
│ 単位: 本  |  単価: ¥2,500  |  重量: 3.2 kg           │
│ 発注点: 10                                           │
├─────────────────────────────────────────────────────┤
│ トランザクション履歴              [+ 新規 Tx]         │
├──────┬──────┬────────┬────────┬──────────────────────┤
│ 日時  │ 種別 │バケット │ 数量    │ 理由                │
├──────┼──────┼────────┼────────┼──────────────────────┤
│01/15 │ IN   │ON_HAND │ +50    │ 仕入先A社より入荷    │
│10:00 │      │        │        │                      │
├──────┼──────┼────────┼────────┼──────────────────────┤
│01/15 │ IN   │RESERVED│ +20   │ 注文#1234 引当       │
│11:00 │      │        │(薄い色)│                      │
└──────┴──────┴────────┴────────┴──────────────────────┘
```

**要件:**
- Available を最も大きく目立つカードで表示
- Reserved 関連の数値は薄い色
- Tx 履歴は新しい順に表示
- RESERVED バケットの Tx 行は薄い色で表示

---

### 3.5 Tx 登録 (`/products/:id/transactions/new`)

**フォーム構成:**

```
┌─────────────────────────────────────────┐
│ トランザクション登録                      │
│ 商品: PIPE-001 ステンレスパイプ 25A      │
├─────────────────────────────────────────┤
│ 現在の在庫:                              │
│ Available: 80 本 | On-hand: 100 本       │
│ Reserved: 20 本 (薄い色)                 │
├─────────────────────────────────────────┤
│ 操作を選択:                              │
│ ○ 入庫 (type=IN)                        │
│ ○ 出庫 (type=OUT)                       │
│ ○ 引当 (type=RESERVE)                   │
│ ○ 引当解除・出荷 (type=OUT + UNRESERVE)  │
│ ○ 返品到着 (type=IN + RESERVE batch)      │
│ ○ 返品検品OK (type=UNRESERVE)            │
│ ○ 返品検品NG・廃棄 (UNRESERVE + OUT batch)│
│ ○ 棚卸補正・増 (type=ADJUST, INCREASE)   │
│ ○ 棚卸補正・減 (type=ADJUST, DECREASE)   │
├─────────────────────────────────────────┤
│ 数量 *         [     ]                   │
│ 理由           [                    ]    │
│                                         │
│              [キャンセル] [登録]          │
└─────────────────────────────────────────┘
```

**要件:**
- 操作をわかりやすいラベルで選択させる (API には type + qty のみ送信、符号はサーバーが決定)
- 「引当解除・出荷」は batch API で OUT + UNRESERVE の2つの Tx を同時に作成
- 「返品到着」は batch API で IN + RESERVE の2つの Tx を同時に作成 (reason: RETURN_ARRIVED / RETURN_PENDING)
- 「返品検品OK」は単一 UNRESERVE (reason: RETURN_OK)
- 「返品検品NG・廃棄」は batch API で UNRESERVE + OUT の2つの Tx を同時に作成 (reason: RETURN_REJECTED / SCRAP)
- 棚卸補正は INCREASE / DECREASE を選択させ、direction として送信
- 出庫系・引当系の操作時は Available チェックの結果をリアルタイムで警告表示
- 登録成功後は商品詳細画面に戻る
